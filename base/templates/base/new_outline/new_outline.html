
{% extends "base/base.html" %} 
{% load static %} 
{% load i18n %} 
{% block sidebar %}

    <a class=" list-group-item list-group-item-action
    bg-secondary" style="color: rgb(243, 243, 243);" href="{% url 'base:planer_detail' instance.id %}" role="button">{{instance.name}}</a>
    <a href="{% url 'base:planer_detail_results' instance.id %}" class="list-group-item list-group-item-action
    bg-light">{% trans 'Results' %}</a>
    <a href="{% url 'base:planer_detail_get_deff' instance.id %}" class="list-group-item list-group-item-action
    bg-light">{% trans 'Deff collection' %}</a>

    <a id="planer-link" onclick="onPlanerLinkClick();" href="{% url 'base:planer_initial_form' instance.id %}" class="list-group-item list-group-item-action
    bg-light">
    {% trans 'Planer' %}
    
    </a>
    <script>
        onPlanerLinkClick = () => {
            setTimeout(()=>{
                const planerLink = document.getElementById("planer-link")
                planerLink.innerHTML = "<span class='spinner-border mr-1 spinner-border-sm text-info my-auto' role='status'></span>{% trans 'Hold on a second...' %}"
            }, 800)
        }
    </script>

{% endblock %} 
{% block phonesidebar %}

    <a class=" list-group-item list-group-item-action
    bg-secondary" href="{% url 'base:planer_detail' instance.id %}" role="button">{{instance.name}}</a>
    <a href="{% url 'base:planer_detail_results' instance.id %}" class="list-group-item list-group-item-action
    bg-light">{% trans 'Results' %}</a>
    <a href="{% url 'base:planer_detail_get_deff' instance.id %}" class="list-group-item list-group-item-action
    bg-light">{% trans 'Deff collection' %}</a>

    <a href="{% url 'base:planer_initial_form' instance.id %}" class="list-group-item list-group-item-action
    bg-light">
    {% trans 'Planer' %}


</a> 

{% endblock %} 
{% block content %}


<div>
    <h5>{% trans 'To continue, please fill in forms with scripts results.' %}</h5>
    <p>{% trans 'Last world update: ' %} {{instance.world.update}}</p>
</div>



<div class="modal fade bd-zbiorka-wojsko-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{% trans 'Off collection' %}</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group" contenteditable="true">
                    <textarea class="form-control" id="zbiorka-wojsko" rows="7" cols="5">{{instance.off_troops}}</textarea>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="modal fade bd-zbiorka-obrona-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{% trans 'Deff collection' %}</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group" contenteditable="true">
                    <textarea class="form-control" id="zbiorka-obrona" rows="7" cols="5">{{instance.deff_troops}}</textarea>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="{% static 'codemirror.js' %}"></script>
<link rel="stylesheet" href="{% static 'codemirror.css' %}">

<div class="row my-3">

    <div class="col-12 col-lg-6">
        <form method='POST'>
            <input type="hidden" name="form-1" value="">
            {% csrf_token %}

            <div>
                {{ form1.off_troops.label_tag }} {{ form1.off_troops }} {% if form1.off_troops.errors %} {% for error in form1.off_troops.errors %} {% if forloop.first %}
                <script>
                    document.addEventListener("DOMContentLoaded", function(event) {
                        $('.cm-s-off-troops-codemirror').addClass('CodeMirror-Invalid');
                        codemirror = $('.cm-s-off-troops-codemirror');
                        var codeMirrorEditor = codemirror[0].CodeMirror;
                        codeMirrorEditor.addLineClass(parseInt('{{error}}'), 'wrap', 'line-error');
                        codeMirrorEditor.scrollIntoView(parseInt('{{error}}'));
                    });
                </script>
                {% else %}
                <script>
                    document.addEventListener("DOMContentLoaded", function(event) {
                        codemirror = $('.cm-s-off-troops-codemirror');
                        var codeMirrorEditor = codemirror[0].CodeMirror;
                        codeMirrorEditor.addLineClass(parseInt('{{error}}'), 'wrap', 'line-error');
                    });
                </script>
                {% endif %} {% endfor %}
                <div class="error-text">
                    <p>{% trans 'Incorrect data in' %} {{form1.off_troops.errors|length}} {% trans 'lines.' %}
                        <a href="{% url 'base:documentation' %}#errors"> {% trans 'Why an error appeared?' %}</a>
                    </p>
                    <p>{% trans '*After clicking submit you will be transferred to first error*' %}</p>
                </div>

                {% endif %} {% if form1.off_troops.errors|length == 0 %} {% for error in form1.errors %}
                <div class="error-text mb-3">
                    {% trans 'The text cannot be empty' %}
                </div>
                <script>
                    document.addEventListener("DOMContentLoaded", function(event) {
                        $('.cm-s-off-troops-codemirror').addClass('CodeMirror-Invalid');
                    });
                </script>
                {% endfor %} {% endif %}

                <div class="help-text">
                    {% trans 'Exact form from off collect script required, see ' %} <a href="{% url 'base:documentation' %}#army-script">{% trans 'docs' %}</a>
                </div>

            </div>


            <button onclick="this.disabled=true;this.form.submit();" class="btn btn-ocean my-3">{% trans 'Submit' %}</button>

        </form>

    </div>
    <script>
        var editor = CodeMirror.fromTextArea(document.getElementById("id_off_troops"), {
            theme: 'off-troops-codemirror',
            lineNumbers: true,
        });
    </script>

    <div class="col-12 col-lg-6">
        <form method='POST'>
            <input type="hidden" name="form-2" value="">
            {% csrf_token %}

            <div>
                {{ form2.deff_troops.label_tag }} {{ form2.deff_troops }} {% if form2.deff_troops.errors %} {% for error in form2.deff_troops.errors %} {% if forloop.first %}
                <script>
                    document.addEventListener("DOMContentLoaded", function(event) {
                        $('.cm-s-deff-troops-codemirror').addClass('CodeMirror-Invalid');
                        codemirror = $('.cm-s-deff-troops-codemirror');
                        var codeMirrorEditor = codemirror[0].CodeMirror;
                        codeMirrorEditor.addLineClass(parseInt('{{error}}'), 'wrap', 'line-error');
                        codeMirrorEditor.scrollIntoView(parseInt('{{error}}'));
                    });
                </script>
                {% else %}
                <script>
                    document.addEventListener("DOMContentLoaded", function(event) {
                        codemirror = $('.cm-s-deff-troops-codemirror');
                        var codeMirrorEditor = codemirror[0].CodeMirror;
                        codeMirrorEditor.addLineClass(parseInt('{{error}}'), 'wrap', 'line-error');
                    });
                </script>
                {% endif %} {% endfor %}
                <div class="error-text mb-3">
                    <p>
                        {% trans 'Incorrect data in' %} {{form2.deff_troops.errors|length}} {% trans 'lines.' %}
                        <a href="{% url 'base:documentation' %}#errors"> {% trans 'Why an error appeared?' %}</a>
                    </p>
                    <p>{% trans '*After clicking submit you will be transferred to first error*' %}</p>
                </div>

                {% endif %} {% if form2.deff_troops.errors|length == 0 %} {% for error in form2.errors %}
                <div class="error-text mb-3">
                    {% trans 'The text cannot be empty' %}
                </div>
                <script>
                    document.addEventListener("DOMContentLoaded", function(event) {
                        $('.cm-s-deff-troops-codemirror').addClass('CodeMirror-Invalid');
                    });
                </script>
                {% endfor %} {% endif %}

                <div class="help-text">
                    {% trans 'Exact form from army collect script required, see ' %} <a href="{% url 'base:documentation' %}#deff-script">{% trans 'docs' %}</a>
                </div>

            </div>


            <button onclick="this.disabled=true;this.form.submit();" class="btn btn-ocean my-3">{% trans 'Submit' %}</button>

        </form>

    </div>

    <script>
        var editor = CodeMirror.fromTextArea(document.getElementById("id_deff_troops"), {
            theme: 'deff-troops-codemirror',
            lineNumbers: true,
        });
    </script>
</div>

<div class="btn-group mt-2">

    <button type="button" class="btn btn-outline-ocean my-2" data-toggle="modal" data-target=".bd-zbiorka-wojsko-lg">
        {% trans 'Army collection preview' %}
    </button>


    <button type="button" class="btn btn-outline-ocean my-2" data-toggle="modal" data-target=".bd-zbiorka-obrona-lg">
        {% trans 'Deff collection preview' %}
    </button>

</div>

{% if error != None %}

<div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content text-white bg-danger">
            <div class="modal-header">
                <h5 class="modal-title">{{error}}</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        </div>
    </div>
</div>



<script>
    document.addEventListener("DOMContentLoaded", function(event) {
        $('.bd-example-modal-lg').modal('show');


    });
</script>

{% endif %} {% endblock %}