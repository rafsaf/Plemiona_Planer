{% extends "base/new_outline/new_outline.html" %}

{% load static %}}
<link rel="stylesheet" href="{% static 'base.css' %}">
{% block content %}


<!-- Modal -->
<div class="modal fade" id="form-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">New message</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
          <div class="row">

          <div class="col-8">
          {% load crispy_forms_tags %}
          <form method='POST'>
            {% csrf_token %}
            {{form|crispy}}
            <button name="save" type="submit" class="btn btn-info">Zmień i zapisz</button>
          </form>
        </div>
          <div class="col-4">
          <form method='POST'>
            {% csrf_token %}
            <div class="btn-group-vertical d-flex" role="group" aria-label="Vertical button group">
              <button id="button1" name="duplicate" type="submit" class="btn btn-outline-info">Rozdziel na pół</button>
              <!--
                <button class="btn btn-outline-info dropdown-toggle disabled" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Dropdown
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                  <button class="dropdown-item disabled" type="button">Action</button>
                  <button class="dropdown-item disabled" type="button">Another action</button>
                  <button class="dropdown-item disabled" type="button">Something else here</button>
                </div>
              

              <button type="button" class="btn btn-outline-primary mt-4">Button</button>
              <button type="button" class="btn btn-outline-primary">Button</button>
              <button type="button" class="btn btn-outline-primary">Button</button>
              -->
            </div>
          </form>
          </div>
          </div>


      </div>

    </div>
  </div>
</div>




<div class="row">
  <!-- Obraz <a href="https://pixabay.com/pl/users/Jo-B-246441/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=3598171"> Jo-B</a> z <a href="https://pixabay.com/pl/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=3598171"> Pixabay</a>-->
  <figure class="col-4">
    <img src='{% static "images/knight-small-rev.png" %}' alt="knight" class="img-fluid">
  </figure>
  <div class="col-4">
    <div class="row justify-content-center">
      <h1 class="h1-responsive mt-5">
        <span class="badge badge-pill badge-info">{{target.player}}</span>
      </h1>
    </div>
    <div class="row justify-content-center">
      <h1 class="h1-responsive">
        <span class="badge badge-secondary">{{target.wioska.coord}}</span>
      </h1>
    </div>
  </div>
  <figure class="col-4">
    <img src='{% static "images/knight-small.png" %}' alt="knight" class="img-fluid">
  </figure>
</div>
<div>
  <div class="container-fluid" id="table" style="max-height: 100vh !important; overflow:hidden;">
    <div class="row">
      <div class="card col-6 col-lg-5 col-xl-4 d-flex flex-column">

        <div style="overflow-y: scroll; height:calc(100vh) !important;">
          <ul class="list-group list-group-flush">
            {% for weight in result_lst %}
            <li class="list-group-item">
              <div class="row justify-content-center">
                <h5 class="mr-1">
                  <span class="badge badge badge-secondary">
                    {{weight.start}}
                  </span>
                </h5>
                <h5>
                  <span class="badge badge badge-info">
                    {{weight.player}}
                  </span>
                </h5>

              </div>
              <table>
                <tr>
                  <th>
                    <img src='{% static "images/ax.png" %}' alt="ax">
                  </th>
                  <th>{{weight.off}}
                  </th>
                  <th>
                  </th>
                  <th>
                    <img src='{% static "images/nobleman.png" %}' alt="ax">
                  </th>
                  <th>
                    {{weight.nobleman}}
                  </th>
                  <th>
                    <svg width="1.3em" height="1.3em" viewBox="0 0 16 16" class="bi bi-signpost" fill="#6c757d" xmlns="http://www.w3.org/2000/svg">
                      <path d="M7 1.414V4h2V1.414a1 1 0 0 0-2 0z"/>
                      <path fill-rule="evenodd" d="M12.532 5H2v4h10.532l1.666-2-1.666-2zM2 4a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h10.532a1 1 0 0 0 .768-.36l1.933-2.32a.5.5 0 0 0 0-.64L13.3 4.36a1 1 0 0 0-.768-.36H2z"/>
                      <path d="M7 10h2v6H7v-6z"/>
                    </svg>
                  </th>
                  <th>
                    {{weight.distance}}
                  </th>
                  </tr>

              </table>

              <div class="row">
                <form method="POST">
                  {% csrf_token %}
                  <button name="{{weight.start}}-down-{{weight.order}}" class="btn btn-default">
                    <svg width="2em" height="2em" viewBox="0 0 16 16" class="bi bi-arrow-down-circle-fill"
                      fill="rgba(133, 221, 32, 0.938)" xmlns="http://www.w3.org/2000/svg">
                      <path fill-rule="evenodd"
                        d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 5a.5.5 0 0 0-1 0v4.793L5.354 7.646a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 9.793V5z" />
                    </svg>
                  </button>
                </form>

                <form method="POST">
                  {% csrf_token %}
                  <button name="{{weight.start}}-up-{{weight.order}}" class="btn btn-default">
                    <svg name="{{weight.start}}" width="2em" height="2em" viewBox="0 0 16 16"
                      class="bi bi-arrow-up-circle-fill" fill="rgba(133, 221, 32, 0.938)"
                      xmlns="http://www.w3.org/2000/svg">
                      <path fill-rule="evenodd"
                        d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-10.646.354a.5.5 0 1 1-.708-.708l3-3a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 6.207V11a.5.5 0 0 1-1 0V6.207L5.354 8.354z" />
                    </svg>
                  </button>
                </form>
                <form method="POST">
                  {% csrf_token %}
                  <button name="{{weight.start}}-delete-{{weight.order}}" class="btn btn-default">
                    <svg width="2em" height="2em" viewBox="0 0 16 16" class="bi bi-x-circle-fill" fill="#6c757d"
                      xmlns="http://www.w3.org/2000/svg">
                      <path fill-rule="evenodd"
                        d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-4.146-3.146a.5.5 0 0 0-.708-.708L8 7.293 4.854 4.146a.5.5 0 1 0-.708.708L7.293 8l-3.147 3.146a.5.5 0 0 0 .708.708L8 8.707l3.146 3.147a.5.5 0 0 0 .708-.708L8.707 8l3.147-3.146z" />
                    </svg>

                  </button>
                </form>
                <form method="POST">
                  {% csrf_token %}
                  <button class="btn btn-default" type="button" data-toggle="modal"
                    data-target="#form-modal" data-order="{{weight.order}}" data-start="{{weight.start}}" data-distance="{{weight.distance}}" data-off="{{weight.off}}" data-nobleman="{{weight.nobleman}}" data-player="{{weight.player}}">
                    <svg width="2em" height="2em" viewBox="0 0 16 16" class="bi bi-journals" fill="#17a2b8"
                      xmlns="http://www.w3.org/2000/svg">
                      <path
                        d="M3 2h8a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2h1a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1H1a2 2 0 0 1 2-2z" />
                      <path
                        d="M5 0h8a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2v-1a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H5a1 1 0 0 0-1 1H3a2 2 0 0 1 2-2zM1 6v-.5a.5.5 0 0 1 1 0V6h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0V9h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0v.5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1z" />
                    </svg>
                  </button>
                </form>




              </div>
            </li>
            {% endfor %}
          </ul>
        </div>
      </div>

      <div class="col-6 col-lg-7 col-xl-8 d-flex flex-column">

      
        <nav aria-label="pagination" id="pagination" class="mt-1">
          <ul class="pagination">
            <li class="page-item">
              <div class="dropdown">
                <button class="btn btn-info dropdown-toggle mr-1" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Sortuj
                </button>

                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                  {% if sort == 'distance' %}
                  <a class="dropdown-item active" href="?page={{ page_obj.number }}&sort=distance#table">Według odległości rosnąco</a>
                  
                  {% else %}
                  <a class="dropdown-item" href="?page={{ page_obj.number }}&sort=distance#table">Według odległości rosnąco</a>
                  {% endif %}

                  {% if sort == 'distance-r' %}
                  <a class="dropdown-item active" href="?page={{ page_obj.number }}&sort=distance-r#table">Według odległości malejąco</a>
                  
                  {% else %}
                  <a class="dropdown-item" href="?page={{ page_obj.number }}&sort=distance-r#table">Według odległości malejąco</a>
                  {% endif %}

                  {% if sort == 'off' %}
                  <a class="dropdown-item active" href="?page={{ page_obj.number }}&sort=off#table">Według ilości wojska</a>
                  {% else %}
                  <a class="dropdown-item" href="?page={{ page_obj.number }}&sort=off#table">Według ilości wojska</a>                  
                  {% endif %}

                  {% if sort == 'nobleman' %}
                  <a class="dropdown-item active" href="?page={{ page_obj.number }}&sort=nobleman#table">Według ilości szlachciców</a>
                  {% else %}
                  <a class="dropdown-item" href="?page={{ page_obj.number }}&sort=nobleman#table">Według ilości szlachciców</a>                  
                  {% endif %}
                </div>
              </div>
            </li>
            {% if page_obj.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?page=1&sort={{sort}}#table">1</a>
            </li>
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.previous_page_number }}&sort={{sort}}#table">Poprzednia</a>
            </li>
            {% else %}
            <li class="page-item disabled">
              <a class="page-link" href="?page=1&sort={{sort}}#table">1</a>
            </li>
            <li class="page-item disabled">
              <a class="page-link">Poprzednia</a>
            </li>
            {% endif %}
            <li class="page-item disabled">
              <a class="page-link">{{ page_obj.number }} z {{ page_obj.paginator.num_pages }}</a>
            </li>
            {% if page_obj.has_next %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.next_page_number }}&sort={{sort}}#table">Następna</a>
            </li>
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}&sort={{sort}}#table">{{page_obj.paginator.num_pages}}</a>
              {% else %}
              <li class="page-item disabled">
                <a class="page-link">Następna</a>
              </li>
              <li class="page-item disabled">
                <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}&sort={{sort}}#table">{{page_obj.paginator.num_pages}}</a>
              {% endif %}
            </li>


          </ul>
        </nav>



        <div style="overflow-y: scroll; height:calc(94vh) !important;">
          <div class="row">
            {% for weight in page_obj %}
            <div class="card col-12 col-lg-6 col-xl-4">
              <h4 class="card-title">
                <div class=" row justify-content-center">
                  <span class="badge badge-pill badge-info mt-1">
                    {{weight.player}}</span>
                </div>
              </h4>

              <div class="card-body">
                <h5 class="card-subtitle ">
                  <span class="badge badge-secondary">
                    {{weight.start.coord}}
                  </span>
                </h5>

                <p class="card-text">
                <table>
                  <tr>
                    <th>
                      <img src='{% static "images/ax.png" %}' alt="ax">
                    </th>
                    <th>{{weight.off}}
                    </th>
                  </tr>
                  <tr>
                    <th>
                      <img src='{% static "images/nobleman.png" %}' alt="ax">
                    </th>
                    <th>
                      {{weight.nobleman}}
                    </th>
                  </tr>
                  <tr>
                    <th>
                      <svg width="1.3em" height="1.3em" viewBox="0 0 16 16" class="bi bi-signpost" fill="#6c757d" xmlns="http://www.w3.org/2000/svg">
                        <path d="M7 1.414V4h2V1.414a1 1 0 0 0-2 0z"/>
                        <path fill-rule="evenodd" d="M12.532 5H2v4h10.532l1.666-2-1.666-2zM2 4a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h10.532a1 1 0 0 0 .768-.36l1.933-2.32a.5.5 0 0 0 0-.64L13.3 4.36a1 1 0 0 0-.768-.36H2z"/>
                        <path d="M7 10h2v6H7v-6z"/>
                      </svg>
                    </th>
                    <th>
                      {{weight.distance_rounded}}
                    </th>
                  </tr>
                </table>

                </p>
                <div class="row">
                  <form method="POST">
                    {% csrf_token %}
                    <button name="{{weight.start.coord}}-add-last" class="btn btn-default">
                      <svg width="2.6em" height="2.6em" viewBox="0 0 16 16" class="bi bi-arrow-down-square"
                        fill="rgba(133, 221, 32, 0.938)" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd"
                          d="M14 1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z" />
                        <path fill-rule="evenodd"
                          d="M4.646 7.646a.5.5 0 0 1 .708 0L8 10.293l2.646-2.647a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 0 1 0-.708z" />
                        <path fill-rule="evenodd" d="M8 4.5a.5.5 0 0 1 .5.5v5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5z" />
                      </svg>
                    </button>
                  </form>
                  <form method="POST">
                    {% csrf_token %}
                    <button name="{{weight.start.coord}}-add-first" class="btn btn-default">
                      <svg width="2.6em" height="2.6em" viewBox="0 0 16 16" class="bi bi-arrow-up-square"
                        fill="rgba(133, 221, 32, 0.938)" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd"
                          d="M14 1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z" />
                        <path fill-rule="evenodd"
                          d="M4.646 8.354a.5.5 0 0 0 .708 0L8 5.707l2.646 2.647a.5.5 0 0 0 .708-.708l-3-3a.5.5 0 0 0-.708 0l-3 3a.5.5 0 0 0 0 .708z" />
                        <path fill-rule="evenodd" d="M8 11.5a.5.5 0 0 0 .5-.5V6a.5.5 0 0 0-1 0v5a.5.5 0 0 0 .5.5z" />
                      </svg>
                    </button>
                  </form>
                </div>
              </div>
            </div>

            {% endfor %}
          </div>
        </div>
        
        
      </div>
    </div>
  </div>


  <script>
    document.addEventListener("DOMContentLoaded", function(event) { 
      $('#form-modal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget) // Button that triggered the modal
        var start = button.data('start')
        var off = button.data('off')
        var nobleman = button.data('nobleman')
        var player = button.data('player')
        var distance = button.data('distance')
        var order = button.data('order')
         
        // Extract info from data-* attributes
        // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
        // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
        var modal = $(this)
        modal.find('.modal-title').text(start)
        modal.find('#button1').attr("name", start+'-duplicate-'+order)
        modal.find('#id_start').val(start)
        modal.find('#id_off').val(off)
        modal.find('#id_snob').val(nobleman)
        modal.find('#id_player').val(player)
        modal.find('#id_distance').val(distance)
        modal.find('#id_order').val(order)
      })
  
      $('.popoverData').popover();
      $('.popoverOption').popover({ trigger: "hover" });
    });
  </script>


  {% endblock %}