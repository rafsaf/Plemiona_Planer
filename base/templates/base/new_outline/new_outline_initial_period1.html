{% extends "base/new_outline/new_outline.html" %} 
{% block content %} 
{% load static %} 
{% load i18n %}
{% load crispy_forms_tags %}

<script src="{% static 'codemirror-min.js' %}"></script>
<script src="{% static 'multi-select-min.js' %}"></script>
<link rel="stylesheet" href="{% static 'codemirror-min.css' %}">
<script src="https://kit.fontawesome.com/dc3f7108e7.js" crossorigin="anonymous"></script>

<div class="row mb-5 mt-2" style="margin-bottom: 12rem!important;">
    <div class="col-12 col-lg-7">
        <div class=" w-100">
          <div class="mb-4 mt-2">
            {% if mode == "real" %}
            <a class="t-tab-teal t-tab-teal-active" href="?t=real">
              {% trans 'Reals' %} &nbsp; <span class="badge badge-secondary">{{len_real}}</span>
            </a>
            {% else %}
            <a class="t-tab-teal" href="?t=real">
              {% trans 'Reals' %} &nbsp; <span class="badge badge-secondary">{{len_real}}</span>
            </a>
            {% endif %}
            {% if mode == "fake" %}
            <a class="t-tab-teal t-tab-teal-active" href="?t=fake">
              {% trans 'Fakes' %} &nbsp; <span class="badge badge-secondary">{{len_fake}}</span>
            </a>
            {% else %}
            <a class="t-tab-teal" href="?t=fake">
              {% trans 'Fakes' %} &nbsp; <span class="badge badge-secondary">{{len_fake}}</span>
            </a>
            {% endif %}
            {% if mode == "ruin" %}
            <a class="t-tab-teal t-tab-teal-active" href="?t=ruin">
              {% trans 'Ruins' %} &nbsp; <span class="badge badge-secondary">{{len_ruin}}</span>
            </a>
            {% else %}
            <a class="t-tab-teal" href="?t=ruin">
              {% trans 'Ruins' %} &nbsp; <span class="badge badge-secondary">{{len_ruin}}</span>
            </a>
            {% endif %}


          </div>
        <form id="form1-form" method='POST'>
          <input type="hidden" name="form1" value=""/>
            {% csrf_token %}

                {% if real_dups or fake_dups or ruin_dups %}
                <div class="mb-2">
                <a class="md-correct2 mt-0" data-toggle="collapse" href="#collapseRepeat" role="button" aria-expanded="false" aria-controls="collapseRepeat" style="text-decoration: none;">
                  {% trans 'Duplicates detected, click to view them' %}
                </a>
                <div class="collapse mb-3 mt-1" id="collapseRepeat">
                  <div class="card card-body">
                    <div class="row">
                      <div class="col-auto my-1">
                        <h5>{% trans 'Targets-Duplicated' %}</h5>
                        {% for dict in real_dups %}
                        <p class="my-0">
                          {{dict.target}} - {{dict.duplicate}} &nbsp; 
                          <span class="lines-wrapper">
                            {{dict.lines}}
                          </span> 
                        </p>
                        {% endfor %}
                      </div>
                      <div class="col-auto my-1">
                        <h5>{% trans 'Fakes-Duplicated' %}</h5>
                        {% for dict in fake_dups %}
                        <p class="my-0">
                          {{dict.target}} - {{dict.duplicate}} &nbsp; 
                          <span class="lines-wrapper">
                            {{dict.lines}}
                          </span> 
                        </p>
                        {% endfor %}
                      </div>
                      <div class="col-auto my-1">
                        <h5>{% trans 'Ruin-Duplicated' %}</h5>
                        {% for dict in ruin_dups %}
                        <p class="my-0">
                          {{dict.target}} - {{dict.duplicate}} &nbsp; 
                          <span class="lines-wrapper">
                            {{dict.lines}}
                          </span> 
                        </p>
                        {% endfor %}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
                {% endif %}
                {{ form1.target }} 
                {% if form1.target.errors %}
                <script>codemirrorValidation(`{{form1.target.errors.as_json|safe}}`, `.CodeMirror`);</script>
                
                <div class="error-text">
                    <p>
                    {% trans 'Incorrect data in' %} {{form1.target.errors|length}} {% trans 'lines.' %}<br><br>
                    {% trans 'Valid lines looks like (assuming that such a village 000|000 exists):' %}<br>
                    {% trans '"000|000" - clean coords' %}<br>
                    {% trans '"000|000:0:0" - coords with :off:noble numbers' %}<br>
                    {% trans '"000|000:0|0|0|0:0" - additional off info, list instead of number' %}<br>
                    {% trans '"000|000:0|0|0|0:0|0|0|0" - max info that can be passed about offs and nobles' %}<br>
                  </p>
                </div>

                {% endif %} 
                {% if form1.target.errors|length == 0 %} 
                
                {% for error in form1.errors %}
                <div class="error-text mb-3">
                    {% trans 'The text cannot be empty' %}
                </div>
                <script>
                    document.addEventListener("DOMContentLoaded", function(event) {
                        $('.CodeMirror').addClass('CodeMirror-Invalid');
                    });
                </script>
                {% endfor %} 

                {% endif %}
              </form>

              <form id="form-complete" action="{% url 'base:planer_complete' instance.id %}">
              </form>

                <div class="btn-group my-3">

                <button onclick="handleClickButton(this,`{% trans 'Saving...' %}`,`form1-form`);" id="form1-btn" class="btn btn-ocean"> {% trans 'Save targets' %}</button>

                
                  <button onclick="handleClickButton(this,`{% trans 'Processing...' %}`,`form-complete`);updateAfterClick(this,`{{estimated_time}}`, `{% trans 'Processing...' %}`)" id="form-complete-btn" class="btn btn-outline-ocean">
                    <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-pen" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                      <path fill-rule="evenodd" d="M13.498.795l.149-.149a1.207 1.207 0 1 1 1.707 1.708l-.149.148a1.5 1.5 0 0 1-.059 2.059L4.854 14.854a.5.5 0 0 1-.233.131l-4 1a.5.5 0 0 1-.606-.606l1-4a.5.5 0 0 1 .131-.232l9.642-9.642a.5.5 0 0 0-.642.056L6.854 4.854a.5.5 0 1 1-.708-.708L9.44.854A1.5 1.5 0 0 1 11.5.796a1.5 1.5 0 0 1 1.998-.001zm-.644.766a.5.5 0 0 0-.707 0L1.95 11.756l-.764 3.057 3.057-.764L14.44 3.854a.5.5 0 0 0 0-.708l-1.585-1.585z"/>
                    </svg>
                    {% trans 'Write an outline' %}
                  </button>       
              </div>
            

        </div>

              <table class="table table-sm table-bordered my-3">
                <thead>
                  <tr>
                    <th scope="col">{% trans 'Description' %}</th>
                    <th scope="col">{% trans 'All' %}</th>
                    <th scope="col">{% trans 'Front' %}</th>
                    <th scope="col">{% trans 'Back' %}</th>
                    <th style="cursor: default;" data-toggle="tooltip" data-placement="top" title="{% trans 'Offs further than maximum distance from front line (equals to' %} {{instance.initial_outline_maximum_front_dist}} {% trans 'now), which will be completely skipped now.' %}" class="text-nowrap"  scope="col">{% trans 'Away' %} <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-question-square" style="margin-bottom: 3px;" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/><path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"/></svg></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th style="cursor: default;">{% trans 'Offs' %}</th>
                    {% for item in instance.avaiable_offs %}
                    <th style="cursor: default;"> {{ item }} </th>
                    {% empty %}
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    {% endfor %}
                  </tr>
                  <tr>
                    <th style="cursor: default;">{% trans 'Nobles' %}</th>
                    {% for item in instance.avaiable_nobles %}
                    <th> {{ item }} </th>
                    {% empty %}
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    {% endfor %}
                  </tr>
                  <tr>
                    <th style="cursor: default;" data-toggle="tooltip" data-placement="top" title="{% trans 'Offs around real targets at maximum distance for nobles (now equals to' %} {{instance.initial_outline_target_dist}})." class="text-nowrap" scope="col">
                      {% trans 'Offs close to real targets' %} <svg style="margin-bottom: 3px;" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-question-square" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/><path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"/></svg>
                      
                    </th>
                    {% for item in instance.avaiable_offs_near %}
                    <th> {{ item }} </th>
                    {% empty %}
                    <th></th>
                    <th></th>
                    <th></th>
                    {% endfor %}
                  </tr>
                  <tr>
                    <th style="cursor: default;" data-toggle="tooltip" data-placement="top" title="{% trans 'Nobles around real targets at maximum distance for nobles (now equals to' %} {{instance.initial_outline_target_dist}})." class="text-nowrap" scope="col">
                      {% trans 'Nobles close to real targets' %} <svg style="margin-bottom: 3px;" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-question-square" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/><path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"/></svg>
                      
                    </th>
                    {% for item in instance.avaiable_nobles_near %}
                    <th> {{ item }} </th>
                    {% empty %}
                    <th></th>
                    <th></th>
                    <th></th>
                    {% endfor %}
                  </tr>
                  <tr>
                    <th>{% trans 'The number of available catapults' %}</th>
                    <th > 
                      {% if instance.avaiable_ruins %}
                      {{instance.avaiable_ruins}}
                      {% endif %}
                    </th>
                  </tr>

                </tbody>
              </table>
              <h4 class="my-4">
              <svg width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-gear" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M8.837 1.626c-.246-.835-1.428-.835-1.674 0l-.094.319A1.873 1.873 0 0 1 4.377 3.06l-.292-.16c-.764-.415-1.6.42-1.184 1.185l.159.292a1.873 1.873 0 0 1-1.115 2.692l-.319.094c-.835.246-.835 1.428 0 1.674l.319.094a1.873 1.873 0 0 1 1.115 2.693l-.16.291c-.415.764.42 1.6 1.185 1.184l.292-.159a1.873 1.873 0 0 1 2.692 1.116l.094.318c.246.835 1.428.835 1.674 0l.094-.319a1.873 1.873 0 0 1 2.693-1.115l.291.16c.764.415 1.6-.42 1.184-1.185l-.159-.291a1.873 1.873 0 0 1 1.116-2.693l.318-.094c.835-.246.835-1.428 0-1.674l-.319-.094a1.873 1.873 0 0 1-1.115-2.692l.16-.292c.415-.764-.42-1.6-1.185-1.184l-.291.159A1.873 1.873 0 0 1 8.93 1.945l-.094-.319zm-2.633-.283c.527-1.79 3.065-1.79 3.592 0l.094.319a.873.873 0 0 0 1.255.52l.292-.16c1.64-.892 3.434.901 2.54 2.541l-.159.292a.873.873 0 0 0 .52 1.255l.319.094c1.79.527 1.79 3.065 0 3.592l-.319.094a.873.873 0 0 0-.52 1.255l.16.292c.893 1.64-.902 3.434-2.541 2.54l-.292-.159a.873.873 0 0 0-1.255.52l-.094.319c-.527 1.79-3.065 1.79-3.592 0l-.094-.319a.873.873 0 0 0-1.255-.52l-.292.16c-1.64.893-3.433-.902-2.54-2.541l.159-.292a.873.873 0 0 0-.52-1.255l-.319-.094c-1.79-.527-1.79-3.065 0-3.592l.319-.094a.873.873 0 0 0 .52-1.255l-.16-.292c-.892-1.64.902-3.433 2.541-2.54l.292.159a.873.873 0 0 0 1.255-.52l.094-.319z"/>
                <path fill-rule="evenodd" d="M8 5.754a2.246 2.246 0 1 0 0 4.492 2.246 2.246 0 0 0 0-4.492zM4.754 8a3.246 3.246 0 1 1 6.492 0 3.246 3.246 0 0 1-6.492 0z"/>
              </svg>
               
                {% trans 'Advanced settings:' %}
                 
              
              </h4>
                <div class="accordion" id="outline-options">
                    <div class="card">
                      <div class="card-header" id="headingOne">
                        <h5 class="mb-0">

                          <button class="btn btn-link collapsed py-2 text-left card-header-button" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                            {% if form2.errors %}
                        <span><svg width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-exclamation-diamond" fill="red" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M6.95.435c.58-.58 1.52-.58 2.1 0l6.515 6.516c.58.58.58 1.519 0 2.098L9.05 15.565c-.58.58-1.519.58-2.098 0L.435 9.05a1.482 1.482 0 0 1 0-2.098L6.95.435zm1.4.7a.495.495 0 0 0-.7 0L1.134 7.65a.495.495 0 0 0 0 .7l6.516 6.516a.495.495 0 0 0 .7 0l6.516-6.516a.495.495 0 0 0 0-.7L8.35 1.134z"/>
                            <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"/>
                          </svg></span>
                        {% endif %}
                            {% trans '1. Available Troops' %}
                          </button>
                        </h5>
                      </div>
                  
                      <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordionExample">
                        <div class="card-body">

                        <h4 class="mb-3">
                          {% trans 'Available troops settings:' %}
                        </h4>
                          <div class="mt-1">
                          <form id="form2-form" method='POST' autocomplete="off">
                            <input type="hidden" name="form2" value=""/>
                            {% csrf_token %}
                          {{form2|crispy}}
                          <button onclick="handleClickButton(this,`{% trans 'Processing...' %}`,`form2-form`);" class="btn btn-ocean" id="form2-btn" >
                            {% trans 'Save and reload troops' %}
                          </button>
                          </form>
                        </div>
                        </div>
                      </div>
                    </div>

                    <div class="card">
                      <div class="card-header" id="headingTwo">
                        <h5 class="mb-0">

                          <button class="btn btn-link collapsed py-2 text-left card-header-button" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="true" aria-controls="collapseTwo">
                            {% if form3.errors %}
                        <span><svg width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-exclamation-diamond" fill="red" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M6.95.435c.58-.58 1.52-.58 2.1 0l6.515 6.516c.58.58.58 1.519 0 2.098L9.05 15.565c-.58.58-1.519.58-2.098 0L.435 9.05a1.482 1.482 0 0 1 0-2.098L6.95.435zm1.4.7a.495.495 0 0 0-.7 0L1.134 7.65a.495.495 0 0 0 0 .7l6.516 6.516a.495.495 0 0 0 .7 0l6.516-6.516a.495.495 0 0 0 0-.7L8.35 1.134z"/>
                            <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"/>
                          </svg></span>
                        {% endif %}
                            {% trans '2. Setting the date' %}
                          </button>
                        </h5>
                      </div>
                      <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionExample">
                        <div class="card-body">
                          <h4 class="mb-5">
                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-calendar" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                              <path fill-rule="evenodd" d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
                            </svg>
                            {% trans 'Current date:' %} <span class="md-error">{{instance.date}}</span> 
                          </h4>
                          <form id="form3-form" method='POST' autocomplete="off">
                            <input type="hidden" name="form3" value="">
                            {% csrf_token %}
                          {{form3|crispy}}
                          <button onclick="handleClickButton(this,`{% trans 'Saving...' %}`,`form3-form`);" class="btn btn-ocean" id="form3-btn" >{% trans 'Save' %}</button>
                          </form>

                        </div>
                      </div>
                    </div>

                    <div class="card">
                      <div class="card-header" id="headingThree">
                        <h5 class="mb-0">

                          <button class="btn btn-link collapsed py-2 text-left card-header-button" type="button" data-toggle="collapse" data-target="#collapseThree" aria-expanded="true" aria-controls="collapseThree">
                            {% if form4.errors %}
                        <span><svg width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-exclamation-diamond" fill="red" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M6.95.435c.58-.58 1.52-.58 2.1 0l6.515 6.516c.58.58.58 1.519 0 2.098L9.05 15.565c-.58.58-1.519.58-2.098 0L.435 9.05a1.482 1.482 0 0 1 0-2.098L6.95.435zm1.4.7a.495.495 0 0 0-.7 0L1.134 7.65a.495.495 0 0 0 0 .7l6.516 6.516a.495.495 0 0 0 .7 0l6.516-6.516a.495.495 0 0 0 0-.7L8.35 1.134z"/>
                            <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"/>
                          </svg></span>
                        {% endif %}
                            {% trans '3. Default mode selection' %}
                          </button>
                        </h5>
                      </div>
                      <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordionExample">
                        <div class="card-body">
                          <table class="table table-sm table-bordered my-1">
                            <thead>
                              <tr>
                                <th scope="col">{% trans 'Description' %}</th>
                                <th scope="col">{% trans 'Current attribute' %}</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr >
                                <th>{% trans 'Mode off' %}</th>
                                <th> {{ instance.get_mode_off_display }} </th>
                              </tr>
                              <tr >
                                <th>{% trans 'Mode noble' %}</th>
                                <th> {{ instance.get_mode_noble_display }} </th>
                              </tr>
                              <tr >
                                <th>{% trans 'Nobles division' %}</th>
                                <th> {{ instance.get_mode_division_display }} </th>
                              </tr>
                              <tr >
                                <th>{% trans 'Nobles guidelines' %}</th>
                                <th> {{ instance.get_mode_guide_display }} </th>
                              </tr>
                              <tr >
                                <th>{% trans 'Nobles split' %}</th>
                                <th> {{ instance.get_mode_split_display }} </th>
                              </tr>
                              <tr >
                                <th>{% trans 'Fake limit per village' %}</th>
                                <th> {{ instance.initial_outline_fake_limit }} </th>
                              </tr>
                              
            
                            </tbody>
                          </table>
                          <h4 class="mt-3">
                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-file-earmark-arrow-down" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                              <path d="M4 0h5.5v1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h1V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2z"/>
                              <path d="M9.5 3V0L14 4.5h-3A1.5 1.5 0 0 1 9.5 3z"/>
                              <path fill-rule="evenodd" d="M8 6a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 1 1 .708-.708L7.5 10.293V6.5A.5.5 0 0 1 8 6z"/>
                            </svg>
                            {% trans 'Change default mode:' %}
                          </h4>
                          <form id="form4-form" method='POST' autocomplete="off">
                            <input type="hidden" name="form4" value="">
                            {% csrf_token %}
                            {{ form4|crispy }}
                          <button onclick="handleClickButton(this,`{% trans 'Saving...' %}`,`form4-form`);" class="btn btn-ocean" id="form4-btn">{% trans 'Save' %}</button>
                          </form>
                        </div>
                      </div>
                    </div>



                    <div class="card">
                      <div class="card-header" id="headingFour">
                        <h5 class="mb-0">

                          <button class="btn btn-link collapsed py-2 text-left card-header-button" type="button" data-toggle="collapse" data-target="#collapseFour" aria-expanded="true" aria-controls="collapseFour">
                            {% trans '4. Writing free noblemans' %}
                          </button>
                        </h5>
                      </div>
                      <div id="collapseFour" class="collapse" aria-labelledby="headingFour" data-parent="#accordionExample">
                        <div class="card-body">
                          {% trans 'This functionality is still planned and is not yet available.' %}
                        </div>
                      </div>
                    </div>

                    <div class="card">
                      <div class="card-header" id="headingFive">
                        <h5 class="mb-0">

                          <button class="btn btn-link collapsed py-2 text-left card-header-button" type="button" data-toggle="collapse" data-target="#collapseFive" aria-expanded="true" aria-controls="collapseFive">
                            {% if form5.errors %}
                        <span><svg width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-exclamation-diamond" fill="red" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M6.95.435c.58-.58 1.52-.58 2.1 0l6.515 6.516c.58.58.58 1.519 0 2.098L9.05 15.565c-.58.58-1.519.58-2.098 0L.435 9.05a1.482 1.482 0 0 1 0-2.098L6.95.435zm1.4.7a.495.495 0 0 0-.7 0L1.134 7.65a.495.495 0 0 0 0 .7l6.516 6.516a.495.495 0 0 0 .7 0l6.516-6.516a.495.495 0 0 0 0-.7L8.35 1.134z"/>
                            <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"/>
                          </svg></span>
                        {% endif %}
                            {% trans '5. Avoid night bonus' %}
                          </button>
                        </h5>
                      </div>
                      <div id="collapseFive" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionExample">
                        <div class="card-body">
                          <div class="mb-5">
                            {% if instance.night_bonus %}
                              <h4>{% trans 'ACTIVE: ' %} <span class="md-correct2"> {%trans 'True' %}</span></h4>
                              <h4>{% trans 'Time 1: ' %} <span class="md-correct2">{{instance.enter_t1}}</span></h4>
                              <h4>{% trans 'Time 2: ' %} <span class="md-correct2">{{instance.enter_t2}}</span></h4>
                            {% else %}
                              <h4>{% trans 'ACTIVE: ' %} <span class="md-error">{% trans 'False' %}</span></h4>
                            {% endif %}
                          </div>

                          <form id="form5-form" method='POST' autocomplete="off">
                            <input type="hidden" name="form5" value="">
                            {% csrf_token %}
                          {{form5|crispy}}
                          <button onclick="handleClickButton(this,`{% trans 'Saving...' %}`,`form5-form`);" class="btn btn-ocean" id="form5-btn" >{% trans 'Save' %}</button>
                          </form>

                        </div>
                      </div>
                    </div>

                    <div class="card">
                      <div class="card-header" id="headingSix">
                        <h5 class="mb-0">

                          <button class="btn btn-link collapsed py-2 text-left card-header-button" type="button" data-toggle="collapse" data-target="#collapseSix" aria-expanded="true" aria-controls="collapseSix">
                            {% if form5.errors %}
                        <span><svg width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-exclamation-diamond" fill="red" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M6.95.435c.58-.58 1.52-.58 2.1 0l6.515 6.516c.58.58.58 1.519 0 2.098L9.05 15.565c-.58.58-1.519.58-2.098 0L.435 9.05a1.482 1.482 0 0 1 0-2.098L6.95.435zm1.4.7a.495.495 0 0 0-.7 0L1.134 7.65a.495.495 0 0 0 0 .7l6.516 6.516a.495.495 0 0 0 .7 0l6.516-6.516a.495.495 0 0 0 0-.7L8.35 1.134z"/>
                            <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"/>
                          </svg></span>
                        {% endif %}
                            {% trans '6. Ruining' %}
                          </button>
                        </h5>
                      </div>
                      <div id="collapseSix" class="collapse" aria-labelledby="headingSix" data-parent="#accordionExample">
                        <div class="card-body">
                          <div class="my-2">
                          <p class="mb-0">{% trans 'Order of demolition of buildings:' %}</p>
                          <p style="font-size:0.9rem;" class="mt-0 md-correct2">{% trans 'Only the buildings listed below will be included in the demolition! (in that order)' %}</p>
                          
                          
                            <span class="multi-select"></span>
                            <p style="height: 0.8rem;" id="multi-select-spinner"></p>
                          </div>
                          <form id="form6-form" method='POST' autocomplete="off">
                            <input type="hidden" name="form6" value="">
                            {% csrf_token %}
                          {{form6|crispy}}
                          <button onclick="handleClickButton(this,`{% trans 'Saving...' %}`,`form6-form`);" class="btn btn-ocean" id="form6-btn" >{% trans 'Save' %}</button>
                          </form>

                        </div>
                      </div>
                    </div>

                    <h3><span class="badge badge-dark my-1 mt-5"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" class="bi bi-recycle" viewBox="0 0 16 16">
                      <path d="M9.302 1.256a1.5 1.5 0 0 0-2.604 0l-1.704 2.98a.5.5 0 0 0 .869.497l1.703-2.981a.5.5 0 0 1 .868 0l2.54 4.444-1.256-.337a.5.5 0 1 0-.26.966l2.415.647a.5.5 0 0 0 .613-.353l.647-2.415a.5.5 0 1 0-.966-.259l-.333 1.242-2.532-4.431zM2.973 7.773l-1.255.337a.5.5 0 1 1-.26-.966l2.416-.647a.5.5 0 0 1 .612.353l.647 2.415a.5.5 0 0 1-.966.259l-.333-1.242-2.545 4.454a.5.5 0 0 0 .434.748H5a.5.5 0 0 1 0 1H1.723A1.5 1.5 0 0 1 .421 12.24l2.552-4.467zm10.89 1.463a.5.5 0 1 0-.868.496l1.716 3.004a.5.5 0 0 1-.434.748h-5.57l.647-.646a.5.5 0 1 0-.708-.707l-1.5 1.5a.498.498 0 0 0 0 .707l1.5 1.5a.5.5 0 1 0 .708-.707l-.647-.647h5.57a1.5 1.5 0 0 0 1.302-2.244l-1.716-3.004z"/>
                    </svg> {% trans 'Updating off troops:' %}</span></h3>
                    <p>{% trans "After pasting the data from the tribe into the Army collection in the previous tab, equivalents models are created in the database for each village (the entered line). This process only takes place once, the first time you enter this tab. If you changed (e.g. you added a new 100 lines of data) the Army collection, use the button below." %}</p>
                    <form id="form-update" action="{% url 'base:planer_update_troops' instance.id %}">
                      <button onclick="handleClickButton(this,`{% trans 'Processing...' %}`,`form-update`);" id="form-update-btn" class="btn btn-outline-ocean mb-3">
                        <svg width="1.3em" height="1.3em" viewBox="0 0 16 16" class="bi bi-arrow-counterclockwise" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z"/>
                        <path d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z"/>
                      </svg>
                      {% trans 'Recreate Models' %}
                      </button>
                    </form>
                  </div>
        <div class="d-block d-lg-none mb-4"></div>
    </div>

    <div class="col-12 col-lg-5" style="border-left: 1px solid #ddd;">
        <div class="h-100">
            <ul class="nav nav-pills mb-3 mt-1" id="pills-tab" role="tablist">
                <li class="nav-item navitem100">
                    <a class="nav-link active ocean-tab-left" id="pills-home-tab" data-toggle="pill" href="#pills-opis" role="tab" aria-controls="pills-home" aria-selected="true">{% trans 'Info' %}</a>
                </li>

                <li class="nav-item navitem100">
                    <a class="nav-link ocean-tab-right" id="pills-contact-tab" data-toggle="pill" href="#pills-przyklady" role="tab" aria-controls="pills-contact" aria-selected="false">{% trans 'Examples' %}</a>
                </li>
            </ul>
            <div class="tab-content" id="pills-tabContent">
                <div class="tab-pane fade show active" id="pills-opis" role="tabpanel" aria-labelledby="pills-home-tab">
                    {{info|safe}}
                </div>

                <div class="tab-pane fade" id="pills-przyklady" role="tabpanel" aria-labelledby="pills-contact-tab">
                    {{example|safe}}
                </div>
            </div>
        </div>
    </div>
    {{ instance.initial_outline_buildings|json_script:"initial-buildings" }}
    <script>
      var editor = CodeMirror.fromTextArea(document.getElementById("id_target"), {lineNumbers: true,});
      var instance = new SelectPure(".multi-select", {
        options: createBuildingsOptions(`{% trans "Headquarters" %}`,`{% trans "Barracks" %}`,`{% trans "Stable" %}`,`{% trans "Workshop" %}`,`{% trans "Academy" %}`,`{% trans "Smithy" %}`,`{% trans "Rally point" %}`,`{% trans "Statue" %}`,`{% trans "Market" %}`,`{% trans "Timber camp" %}`,`{% trans "Clay pit" %}`,`{% trans "Iron mine" %}`,`{% trans "Farm" %}`,`{% trans "Warehouse" %}`,`{% trans "wall" %}`),
        multiple: true,
        value: JSON.parse(document.getElementById('initial-buildings').textContent),
        icon: "fa fa-times",
        onChange: value => { changeBuildingsArray(`{{instance.pk}}`,instance.value()); }
      });
    
    </script>
</div>
{% if premium_error %}

<div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content text-white bg-danger">
            <div class="modal-header">
                <h3 class="modal-title">{% trans 'An error occured' %}</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <h5>{% trans "Premium account is required to complete outlines greater than 25 targets. Buy it" %} <b><a style='color:white;text-decoration:underline' href="{% url 'base:premium' %}">{% trans 'here' %}</a></b> {% trans "or reduce the number of outline targets." %}</h5>
            </div>
        </div>
    </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function(event) {
        $('.bd-example-modal-lg').modal('show');
    });
</script>
{% endif %}
{% endblock %}