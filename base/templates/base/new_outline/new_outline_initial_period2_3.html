{% extends "base/new_outline/new_outline_initial_period2.html" %}
{% load static %}
{% load i18n %}
{% load crispy_forms_tags %}
{% block content %}
<input id="speed_world" type="hidden" value="{{instance.world.speed_world}}">
<input id="speed_units" type="hidden" value="{{instance.world.speed_units}}">

<div>
{% block outline_navbar %}
{{block.super}}
{% endblock %}

<div class="container-fluid" style="margin-left: -15px; margin-right:-15px;">

    <div class="mt-4">
        {% if message %}
        <div id="s-message">
            <small  class="badge badge-success mb-1">
                {% trans 'Target added successfully!' %}
            </small>
        </div>
        <script>
            setTimeout(()=>{
                const message=document.getElementById("s-message");
                message.style.display = 'none';
            }, 1500)
        </script>
        {% endif %}
    </div>
    
    <table class="table table-bordered mb-3" style="width: min-content;">
        <thead>
            <tr>
                <th style="min-width: 25vh;" class="text-nowrap">{% trans 'Create a single Target' %}</th>
                <th style="min-width: 25vh;" class="text-nowrap">
                    <form id="create-form" method='POST' autocomplete="off">{% csrf_token %}
                        <input name="create" type="hidden" value="">
                        <input id="type-form" name="type-form" type="hidden" value="">
                        {{ target_form.target }}
                    </form>
                    {% for error in target_form.target.errors %}
                    <div class="md-error">
                        {{ error }}
                    </div>
                    {% endfor %}
                </th>
                <th class="text-nowrap"><button onclick="this.disabled=true;fillAndSubmit(`real`)" style="height: 48px;border-radius: 0 !important;" class="btn btn-lg btn-ocean">{% trans 'Create Real' %}</button></th>
                <th class="text-nowrap"><button onclick="this.disabled=true;fillAndSubmit(`fake`)" style="height: 48px;border-radius: 0 !important;" class="btn btn-lg btn-ocean">{% trans 'Create Fake' %}</button></th>
                <th class="text-nowrap"><button onclick="this.disabled=true;fillAndSubmit(`ruin`)" style="height: 48px;border-radius: 0 !important;" class="btn btn-lg btn-ocean">{% trans 'Create Ruin' %}</button></th>
            </tr>
            <script>
                const fillAndSubmit = (value) => {
                    const form = document.getElementById("create-form");
                    const inputField = document.getElementById("type-form");
                    inputField.value = value;
                    form.submit();
                } 
            </script>
        </thead>
    </table>


    <table class="table table-sm table-bordered mb-4 mt-2" style="width: min-content;">
        <thead>
            <tr>
                <th rowspan="2" style="min-width: 25vh;" class="text-nowrap">{% trans 'Delete Targets below' %}</th>
                <th style="min-width: 25vh;" class="text-nowrap">{% trans 'Filter by Enemy Player' %}</th>
                <th style="min-width: 25vh;" class="text-nowrap">{% trans 'Filter by Coord' %}</th>
                <th style="min-width: 25vh;" class="text-nowrap">{% trans 'Filter' %}</th>
            </tr>
            <tr>
                <form method="GET">
                    <input name="page" type="hidden" value="1">
                    <input name="mode" type="hidden" value="{{mode}}">
                    <th style="min-width: 25vh;" class="text-nowrap"><input name="player" class="form-control" type="search" value="{{player}}"></th>
                    <th style="min-width: 25vh;" class="text-nowrap"><input name="coord" class="form-control" type="search" value="{{coord}}"></th>
                    <th style="min-width: 25vh;" class="text-nowrap"><button class="btn btn-info">{% trans 'Filter' %}</button></th>
                </form>



            </tr>

        </thead>
    </table>
    {% block outline_navigation %}
    {{block.super}}
    {% endblock %}
    <table class="table table-sm table-bordered" style="width:min-content">
        <thead>
            <tr>
                <th scope="col">{% trans 'Target' %}</th>
                <th class="text-nowrap" scope="col">{% trans 'Delete' %}</th>
                <th colspan="50" scope="colgroup">{% trans 'Outline' %}</th>
            </tr>
        </thead>
        <tbody>
            {% for target, lst in query %}
            <tr id="target-row-{{target.pk}}">
                <th>
                    <div class="d-flex justify-content-center">
                        <h5>
                            <span class="badge badge-pill badge-info">
                                {{target.player}}
                            </span>
                        </h5>
                    </div>
                    <div class="d-flex justify-content-center">
                        <h5>
                            <span class="badge badge badge-secondary">
                                {{target.target}}
                            </span>
                        </h5>
                    </div>
                </th>
                <th style="min-width: 15vh !important;" class="text-center">
                    <button id="target-btn-{{target.pk}}" onclick="deleteTarget(`{{target.pk}}`);" class="btn btn-outline-danger">
                        {% trans 'Delete' %}
                    </button>

                </th>
                {% for weight in lst %}
                <th class="front-{{weight.first_line}}">
                    <div class="popoverData" data-html="true"
                        data-content="<h4><span class='badge badge-pill badge-info'>{{weight.player}}</span></h4><div class='d-flex justify-content-center'><h5><span class='badge badge badge-secondary'>{{weight.start}}</span></h5></div>"
                        rel="popover" data-placement="top" data-trigger="hover">
                        <table class="table table-sm">
                            <tr>
                                <th>
                                    <img src='{% static "images/ax.png" %}' alt="ax">
                                </th>
                                <th style="font-size: small;cursor:default;">
                                    {{weight.off}}
                                </th>
                            </tr>
                            <tr>
                                <th>
                                    <img src='{% static "images/nobleman.png" %}' alt="ax">
                                </th>
                                <th style="font-size: small;cursor:default;">
                                    {{weight.nobleman}}
                                </th>
                            </tr>
                            <tr>
                                <th>
                                    <svg width="1.3em" height="1.3em" viewBox="0 0 16 16" class="bi bi-signpost"
                                        fill="#6c757d" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M7 1.414V4h2V1.414a1 1 0 0 0-2 0z" />
                                        <path fill-rule="evenodd"
                                            d="M12.532 5H2v4h10.532l1.666-2-1.666-2zM2 4a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h10.532a1 1 0 0 0 .768-.36l1.933-2.32a.5.5 0 0 0 0-.64L13.3 4.36a1 1 0 0 0-.768-.36H2z" />
                                        <path d="M7 10h2v6H7v-6z" />
                                    </svg>
                                </th>
                                <th style="font-size: small;cursor:pointer;" onclick="calculate_distance(this);">
                                    {{weight.distance}}
                                </th>
                            </tr>
                        </table>
                </th>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>



</div>
</div>
<script>
    activateTooltips();
</script>

{% block outline_go_back %}
{{block.super}}
{% endblock %}

{% endblock %}