{% extends "base/new_outline/new_outline_initial_period2.html" %}
{% load static %}
{% load i18n %}
{% load crispy_forms_tags %}
{% block content %}


<div class="fixed-scrollbar-container">
{% block outline_navbar %}
{{block.super}}
{% endblock %}

<div class="conatiner-fluid text-center" id='leftscroll'>
    <h2>
        <span class="my-2">
            {% trans 'You can add & remove targets here.' %}
        </span>
    </h2>
    {% if message %}
    <small class="badge badge-success">
        {% trans 'Target added successfully !' %}
    </small>
    {% endif %}
    <div id='target-form' class="col-12 col-lg-4 mx-auto my-2">

        <form method='POST' autocomplete="off">{% csrf_token %}
            <input name="create" type="hidden" value="">
            {{ target_form|crispy }}
            <button onclick="this.disabled=true;this.form.submit();" class="btn btn-block btn-ocean my-2">{% trans 'Create' %}</button>
        </form>
    </div>
    <table class="table table-bordered col-6 mx-auto mt-5">
        <thead>
            <tr>
                <th scope="col">{% trans 'Remove' %}</th>
                <th scope="col">{% trans 'Target' %}</th>
                <th scope="col">{% trans 'Orders Number' %}</th>
            </tr>
        </thead>
        <tbody>

            {% for target, number in query %}
            <tr>
                <th>
                    <form method="POST" action="{% url 'base:planer_delete_target' instance.id target.id %}?page={{ query.number}}&mode={{mode}}">
                        {% csrf_token %}

                        <button onclick="this.disabled=true;this.form.submit();" class="btn btn-outline-danger">{% trans 'Delete' %}</button>
                    </form>
                    
                </th>
                <th class="front-{{target.fake}}">

                    <div class="d-flex justify-content-center">
                        <h5>
                            <span class="badge badge-pill badge-info">
                                {{target.player}}
                            </span>
                        </h5>
                    </div>
                    <div class="d-flex justify-content-center">

                        <h5>
                            <span class="badge badge badge-secondary">
                                {{target.target}}
                            </span>
                        </h5>

                    </div>
                    {% if target.fake %}
                    <div class="d-flex justify-content-center">

                        <h5 style="color: teal;" class="font-italic">
                            Fake
                        </h5>
                    </div>
                    {% endif %}

                </th>

                <th>
                    {{ number }}
                </th>


            </tr>
            {% endfor %}

        </tbody>
    </table>
</div>
</div>
<script>
    activateTooltips();
    $(function($) {
        var fixedBarTemplate = '<div class="fixed-scrollbar"><div></div></div>';
        var fixedBarCSS = { display: 'none', overflowX: 'scroll', position: 'fixed', width: '100%', bottom: 0 };

        $('.fixed-scrollbar-container').each(function() {
            var $container = $(this);
            var $bar = $(fixedBarTemplate).appendTo($container).css(fixedBarCSS);

            $bar.scroll(function() {
                $container.scrollLeft($bar.scrollLeft());
            });

            $bar.data("status", "off");
        });

        var fixSize = function() {
            $('.fixed-scrollbar').each(function() {
                var $bar = $(this);
                var $container = $bar.parent();

                $bar.children('div').height(1).width($container[0].scrollWidth);
                $bar.width($container.width()).scrollLeft($container.scrollLeft());
            });
        };

        $(window).on("load.fixedbar resize.fixedbar", function() {
            fixSize();
        });

        var scrollTimeout = null;

        $(window).on("scroll.fixedbar", function() {
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(function() {
                $('.fixed-scrollbar-container').each(function() {
                    var $container = $(this);
                    var $bar = $container.children('.fixed-scrollbar');

                    if ($bar.length) {
                        var containerOffset = { top: $container.offset().top, bottom: $container.offset().top + $container.height() };
                        var windowOffset = { top: $(window).scrollTop(), bottom: $(window).scrollTop() + $(window).height() };

                        if ((containerOffset.top > windowOffset.bottom) || (windowOffset.bottom > containerOffset.bottom)) {
                            if ($bar.data("status") == "on") {
                                $bar.hide().data("status", "off");
                            }
                        } else {
                            if ($bar.data("status") == "off") {
                                $bar.show().data("status", "on");
                                $bar.scrollLeft($container.scrollLeft());
                            }
                        }
                    }
                });
            }, 50);
        });

        $(window).trigger("scroll.fixedbar");
    });
</script>
<div class="modal fade" id="ValidationModal" tabindex="-1" role="dialog"
aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="ValidationModalTitle">{% trans 'Warning' %}</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            {% blocktrans %} Current progress will be
            <div class="md-error">LOST!</div>
            <br>You will return to the previous form. {% endblocktrans %}

        </div>
        <div class="modal-footer">
            <button id="dismiss-btn" type="button" class="btn btn-secondary"
                data-dismiss="modal"><b>{% trans 'Close' %}</b></button>
            <form id="form1-form" method="POST">
                <input type="hidden" name="form1" value="">
                {% csrf_token %}
                <button id="form1-btn" class="btn btn-ocean">
                    {% trans 'Continue' %}
                </button>

            </form>
        </div>
        <script>
            const buttonForm1 = document.getElementById("form1-btn")
            const buttonDismiss = document.getElementById("dismiss-btn")
            buttonForm1.onclick = () => {
                buttonForm1.disabled = true
                buttonDismiss.disabled = true
                buttonForm1.innerHTML = "<span class='spinner-border mr-1 spinner-border-sm text-dark my-auto' role='status'></span>{% trans 'Processing...' %}"
                const form1 = document.getElementById("form1-form")
                form1.submit()
              }
        </script>
    </div>
</div>
</div>
{% endblock %}